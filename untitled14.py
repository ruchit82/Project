# -*- coding: utf-8 -*-
"""Untitled14.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1aHPwHTOHyDChtT8tTnmoHPKD_f39w-iK
"""
import pandas as pd
import streamlit as st
import requests

SHEET_URL = "https://docs.google.com/spreadsheets/d/1Jwx4TntDxlwghFn_eC_NgooXlpvR6WTDdvWy4PO0zgk/export?format=csv"

def load_data():
    try:
        response = requests.get(SHEET_URL)
        response.raise_for_status()  
        
        df = pd.read_csv(SHEET_URL)
        df['DATE'] = pd.to_datetime(df['DATE'], errors='coerce')
        return df
    
    except Exception as e:
        st.error(f"Error loading data: {e}")
        return pd.DataFrame()

df = load_data()

st.write("âœ… Live Data Loaded Successfully!") if not df.empty else st.warning("âš ï¸ No data available!")

# Sidebar Navigation
st.sidebar.title("ğŸ“Š Inventory App")
page = st.sidebar.radio("ğŸ” Navigate to", ["Dashboard", "Full Inventory", "Aged Stock"])

# Page 1: Dashboard
if page == "Dashboard":
    st.title("ğŸ“ˆ Stock Inventory Dashboard")

    if not df.empty:
        total_pcs = df["PCS"].sum()
        total_wt = df["WT"].sum()
        st.metric("ğŸ“¦ Total Pieces", total_pcs)
        st.metric("âš–ï¸ Total Weight", total_wt)
        st.subheader("ğŸ“… Stock Distribution Over Time")
        st.line_chart(df.groupby(df["DATE"].dt.date)["PCS"].sum())
    else:
        st.warning("âš ï¸ No data available! Please check your Google Sheets link.")

# Page 2: Full Inventory
elif page == "Full Inventory":
    st.title("ğŸ“‹ Complete Inventory Data")
    if not df.empty:
        st.dataframe(df)
        st.download_button("ğŸ“¥ Download Data", df.to_csv(index=False), "inventory.csv")
    else:
        st.warning("âš ï¸ No data available!")

# Page 3: Aged Stock (More than 15 Days)
elif page == "Aged Stock":
    st.title("â³ Stock Older than 15 Days")
    if not df.empty:
        cutoff_date = datetime.datetime.today() - datetime.timedelta(days=15)
        aged_stock = df[df["DATE"] < cutoff_date]
        if not aged_stock.empty:
            st.dataframe(aged_stock)
            st.download_button("ğŸ“¥ Download Aged Stock", aged_stock.to_csv(index=False), "aged_stock.csv")
        else:
            st.info("âœ… No stock older than 15 days.")
    else:
        st.warning("âš ï¸ No data available!")
